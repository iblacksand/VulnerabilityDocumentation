# Vulnerability Documentation

This is the documentation to test vulnerabilities in password managers found in the paper [Analysis on the Security and Use of Password Managers](https://www.overleaf.com/read/gtxjfrdntkyq). We have found five successful attacks that exploit vulnerabilities in Passbolt, Padlock and Encryptr.

### Attacks

<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->


- [Userscripts](#userscripts)
  - [Installing Scripts](#installingscripts)
  - [Passbolt Fake Extension Installer](#passboltfakeextensioninstaller)
  - [Padlock Data Reset](#padlockdatareset)
    - [Padlock Application Setup](#padlockapplicationsetup)
  - [Padlock Access Remover](#padlockaccessremover)
    - [Padlock Application Setup](#padlockapplicationsetup)
- [User Input Attacks](#userinputattacks)
  - [Keylogger Attack](#keyloggerattack)
  - [Clipboard Reader](#clipboardreader)
  - [Installation](#installation)
  - [Setup](#setup)
  - [Stopping the Program](#stoppingtheprogram)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->


## Userscripts

Before you start using any of the userscript attacks, you need to use a userscript manager.

For Chrome, use [Tampermonkey](https://tampermonkey.net/).

For Firefox, use [Greasemonkey](https://addons.mozilla.org/en-US/firefox/addon/greasemonkey/)

### Installing Scripts

Tampermonkey and Greasemonkey should automatically install the userscripts when you click the given install link. If you have trouble installing any userscript look at the wiki for your userscript manager.

Tampermonkey - [https://tampermonkey.net/faq.php#Q102](https://tampermonkey.net/faq.php#Q102)

Greasemonkey - [https://wiki.greasespot.net/Greasemonkey_Manual:Installing_Scripts](https://wiki.greasespot.net/Greasemonkey_Manual:Installing_Scripts).

Firefox is preferred because all the scripts will execute fully on Firefox.

### Passbolt Fake Extension Installer

[**Install**](https://github.com/iblacksand/VulnerabilityDocumentation/raw/master/PassboltFakeExtensionInstaller.user.js)

This script will change all links that download the passbolt extension to download a random script(we choose [NoScript](https://addons.mozilla.org/en-US/firefox/addon/noscript/)). For this to work you need to use Firefox(See [Userscripts](#userscripts) for more info).

After you install the program, you can use your own Passbolt server(look at Passbolt's [medium blog](https://medium.com/passbolt/passbolt-on-debian-8-71-from-scratch-4438dad18908) for a tutorial on how to set it up), or you can use [Passbolt's demo server](https://demo.passbolt.com). Make sure that you **don't** have Passbolt's extension installed, or else no links will show.

1. Go to your server's login page.(For Passbolt's demo this is [demo.passbolt.com](https://demo.passbolt.com))

2. Hover over the link that says `Download it here`

![Hover over link](/images/PassboltExt-04.png)

3. Look at the bottom left and notice that Firefox says the link goes to `https://www.passbolt.com/download/firefox`

![Firefox shows link still is Passbolt](/images/PassboltExt-01.png)

4. Click on the link and press allow on the Firefox popup

![Allow server to install extension](/images/PassboltExt-05.png)

5. Notice how Firefox is installing `Noscript` Rather than `Passbolt`. 

![Downloads NoScript instead of Passbolt](/images/PassboltExt-06.png)

The script made the link look like it was downloading a link from Passbolt but it changed the link to download a different link. This extension could have the logo and name of Passbolt and the user will be unlikely to see any foul play.

If the script didn't work or their was problem testing, [open an issue](https://github.com/iblacksand/VulnerabilityDocumentation/issues) and we will come back to you.

### Padlock Data Reset

[**Install**](https://github.com/iblacksand/VulnerabilityDocumentation/raw/master/PadlockButtonClick.user.js
)

This script will automatically reset all data on a Padlock account. 

#### Padlock Application Setup

You first need to install Padlock and get the cloud connected. You can download Padlock [here](http://padlock.io/). You can use the Padlock cloud [here](https://cloud.padlock.io/login/), which is on a 30 day trial, or you can use your own Padlock cloud which you can install from [here](https://github.com/maklesoft/padlock-cloud). If you use a custom server, you can check out my [custompadlock repo](https://github.com/iblacksand/custompadlock) which is a custom application that will allow the application to use `http://` so you don't have to get a certificate. 

Once you get your cloud and program running, go to the Padlock application itself. Log into your account, and get to page that has `Import Data, Synchronize and Create Record`. Click on `Synchronize data > Open Padlock Cloud Settings`. If you use a custom server click on `use custom server > continue` and enter the IP of your server. Next press `get started` and then enter in your email(You can use a service like [guerrillamail](https://www.guerrillamail.com/) to make multiple accounts). Then press `connect`. Go into your email and you should receive an email with a link. Click on the link and your application should be synced with the cloud. You can check this by clicking `synchronize` on the application. The application should say that it synced correctly. You can go back to the application and press the `<` in the top left twice until you get back to the screen with `Import Data, Synchronize and Create Record`. Click `Create Record` and enter an example name, like `test name` and then press `add`. Click on the box with `username` then click `edit`. You can now enter in an example username like `testusername`. Then click anywhere outside of the text box. Now click the box with `password` then click `Edit`. Enter in a password like `testpassword`. Then click anywhere outside of the box. Your screen should know look like

![](/images/Padlock-01.png)

### Padlock Access Remover

#### Padlock Application Setup

## User Input Attacks

Both user input attacks were built in C# for use only on Windows devices. They work in much the same way. Both of the attacks save plain-text logs with timestamps. Every 10 minutes, the attacks send the logs to our email and delete them from the victim's computer.

### Keylogger Attack

The keylogger saves every key press and click into a plain-text file. It attaches a timestamp at the beginning of each log and after 30 seconds of inactivity.

### Clipboard Reader

The clipboard reader checks four times every second to see if the contents of the clipboard have changed. Every time it detects a change, it logs the timestamp and clipboard contents.

### Installation

Both of these attacks can be hidden in the installation of a different program and set up to run every time Windows boots up. For our purposes, we combined both attacks into a single installation.

In order to test, first [go to this link](https://github.com/iblacksand/VulnerabilityDocumentation/releases) and download one of the below files:

* Manual-start program: download loggers.zip
* Windows-startup installer: download setup.exe

If you download the manual-start, unzip the file and skip to [Setup](#setup)

If you download the installer, the files will be saved in the following location:
\
`C:\Users\<WINDOWS ACCOUNT NAME>\AppData\Local\Fake Microsoft Process`

### Setup

In the folder where you saved the file should be a file called config.json
\
Enter in your email and password. The program will send you emails from yourself with the logs attached. You must use a gmail account. Example:
```json
{
    "email": "exampleaccount@gmail.com",
    "password": "examplePassw0rd"
}
```
Next you must click this link to [allow less secure apps](https://myaccount.google.com/lesssecureapps?rfn=27&rfnc=1&eid=1003975247538190077&et=0&asae=2&pli=1).

Now double click temps.exe to run the program. For testing purposes we have set the program to email you every 40 seconds instead of 10 minutes, so type, copy/paste, etc and check your email after 40 seconds.

### Stopping the Program

When you are done testing, press `Ctrl + Alt + Delete` to open Task Manager. Look for `temps` under background processes and end the process.

**If you used the Windows-startup installer** and you want to remove it from your startup processes, press `Ctrl + Alt + Delete` to open Task Manager. Click on the `Startup` tab on the top bar of Task Manager. Click on `temps` and click `Disable`.